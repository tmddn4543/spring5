<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      layout:decorate="~{layouts/default}">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Recording</title>

    <!-- option -->

    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxcore.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxdatetimeinput.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxcalendar.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/globalization/globalize.js}"></script>

    <!-- DropDownList -->

    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxbuttons.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxscrollbar.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxlistbox.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxdropdownlist.js}"></script>

    <!-- Grid -->



    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxdata.js}"></script> 
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxmenu.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxgrid.js}"></script>
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxgrid.pager.js}"></script> 
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxgrid.columnsresize.js}"></script> 
    <script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxgrid.selection.js}"></script> 
 	<script type="text/javascript" th:src="@{/resource/assets/jqwidgets/jqxpanel.js}"></script>
	
	
<!--     <script type="text/javascript" th:inline="javascript" th:src="@{/resource/assets/js/page/call_page.js}"></script> -->



<script type="text/javascript">
$(document).ready(
	    function(){
	    	var emp = "";
	        var branch_cd = "";
	        var auth_cd = "";
	        var caller = "";
	    	var called = "";
	    	var selectday = "";
	    	var selectstime = "";
	    	var selectetime = "";
	    	var bday = "";
	    	var eday = "";
	    	var rec_type = "";
	    	var end_talk_time = "";
	    	var start_talk_time = "";
	    	var caller_attr = "";
	    	var called_attr = "";
	    	var startRow = "";
	    	var pageSize = "";
	    	var recordstartindex = 0;
	    	var arr_batch = new Array();
	    	var arr_c_id = new Array();
	    	var arr_YYYYMM = new Array();


	        /* 소스 */
	        var source = [
	            "전체",
	            "전수녹취",
	            "인증녹취",
	            "녹취정지"
	        ];
	        // Create a jqxDropDownList
	        $(".record_type").jqxDropDownList({ source: source, selectedIndex: 1, width: 100 + "%", height: 34, autoItemsHeight: true, theme: "bootstrap", autoDropDownHeight: true});


	        var source = [
	            "전체",
	            "시스템관리자",
	            "운용사용자",
	            "그룹관리자",
	            "상담원",
	            "알람서비스등록"
	        ];
	        // Create a jqxDropDownList
	        $(".authority_num").jqxDropDownList({ source: source, selectedIndex: 1, width: 100 + "%", height: 34, autoItemsHeight: true, theme: "bootstrap", autoDropDownHeight: true});



	        // create jqxcalendar.
	        $(".jqxcalendar_act").jqxDateTimeInput({ width: 100 + "%", height: 32,  selectionMode: "range", formatString: "yyyy:MM:dd", theme: "bootstrap" });
	        $(".jqxcalendar_act").on("jqxcalendar", function (event) {
	            var selection = $("#jqxWidget").jqxDateTimeInput("getRange");
	            if (selection.from != null) {
	                $("#selection").html("<div>From: " + selection.from.toLocaleDateString() + " <br/>To: " + selection.to.toLocaleDateString() + "</div>");
	            }
	        });
	        var cal_date = new Date();
	        
	        $(".jqxcalendar_act").jqxDateTimeInput("setRange", cal_date, cal_date);
	        


	        /* time select box */
	        var Html = []; //배열로 담을 변수 선언
	        var value = ""; //값을 입력할 변수 선언

	        //시간 삽입
	        for (var i = 0; i < 24; i++) {// 0 부터 23 까지 for문으로 생성
	            if(i < 10) {// 값이 10보다 작을때에는 앞에 0을 하나 더 붙여주기 위해 if문으로 걸러냄.
	                value = "0" + i;
	            }else{
	                value = i;
	            }

	            Html[i] = "<option value = "+value+" > "+value+"</option>"; //option값을 만든 다음 value값을 셋팅
	            
	        }
	        $(".selStartTime").append(Html.join(""));
	        $(".selEndTime").append(Html.join(""));
	        $(".selEndTime").val("23").prop("selected",true);

	        /* 조회클릭 */
	        $("#next_action1").click(function(){
	        	branch_cd = $("#group_btn_act1").val();
	        	caller = $("#caller1").val();
	        	called = $("#called1").val();
	        	selectday = $("#jqxcalendar_act1").val();
	        	selectstime = $("#selStartTime1").val();
	        	selectetime = $("#selEndTime1").val();
	        	bday = bdayFormat(selectday,selectstime);
	        	eday = edayFormat(selectday,selectetime);
	        	
	        	$("#caller2").val(caller);
	        	$("#called2").val(called);
	        	
	        	rec_type = recFormat2($("#record_type1").val());
	        	emp = $("#emp1").val();
	        	end_talk_time = $("#end_talk_time1").val();
	        	start_talk_time = $("#start_talk_time1").val();
	        	callSearch();
	        	
	            $(".hide").removeClass("hide");
	            $(".first_page").css({"display" : "none"});
	        });
	        
	        
	        $("#next_action2").click(function(){
	        	branch_cd = $("#group_btn_act2").val();
	        	caller = $("#caller2").val();
	        	called = $("#called2").val();
	        	selectday = $("#jqxcalendar_act2").val();
	        	selectstime = $("#selStartTime2").val();
	        	selectetime = $("#selEndTime2").val();
	        	bday = bdayFormat(selectday,selectstime);
	        	eday = edayFormat(selectday,selectetime);
	        	rec_type = recFormat2($("#record_type2").val());
	        	emp = $("#emp2").val();
	        	end_talk_time = $("#end_talk_time2").val();
	        	start_talk_time = $("#start_talk_time2").val();
	        	callSearch();
	        });


	        function callSearch(){
	        	
	        	var source =
	            {
	                 datatype: "json",
	                 data : {emp : emp,
	 					branch_cd : branch_cd,
	 					auth_cd : auth_cd,
	 					bday : bday,
	 					eday : eday,
	 					caller : caller,
	 					called : called,
	 					rec_type : rec_type,
	 					end_talk_time : end_talk_time,
	 					start_talk_time : start_talk_time,
	 					caller_attr : caller_attr,
	 					called_attr : called_attr},
	                 datafields: [
						 { name: 'num'},
						 { name: 'emp_nm'},
						 { name: 'caller'},
						 { name: 'called'},
						 { name: 'auth_cd'},
						 { name: 'emp_id'},
						 { name: 'branch_cd'},
						 { name: 'rec_type'},
						 { name: 'call_date'},
						 { name: 'call_hour'},
						 { name: 'call_time'},
						 { name: 'dirname'},
						 { name: 'YYYYMM'},
						 { name: 'c_id'}
	                ],
				    url: '/call/callSearch_YYYYMMDD',
				    root: 'Rows',
	                cache: false,
					beforeprocessing: function(data)
					{		
						//recordstartindex = data.recordstartindex;
						source.totalrecords = data.total;
					}
	            };		
				
			    var dataadapter = new $.jqx.dataAdapter(source);

	            // initialize jqxGrid
			    
			    var initrowdetails = function (index, parentElement, gridElement, datarecord) {
			    	$(".checkbox_name").each(function(){  // .each()는 forEach를 뜻한다.
		    			if($(this).is(":checked")){
		    				var res = $(this).val();
		    				arr[count] = res;
		    				count = count+1;
		    			}  
		        	});
			    	alert(conut);
			        var details = $($(parentElement).children()[0]);
			        details.html("Details: " + index);
			    }
			    
			    
			    
			    	$("#grid").jqxGrid(//킵
		                    {
		                    	source: dataadapter,
		                        width: 100 + "%",
		                        height:  + "%",
		                        autoheight: true, 
		                        theme: 'material',
		                        rowdetails: true,
		                        rowdetailstemplate: {
		                            rowdetails: "<div style='margin: 20px !important;'>Row Details</div>",
		                            rowdetailsheight: 100
		                        },
		                        virtualmode: true,
		                        pageable: true,
		                        rendergridrows: function(obj)
		        				{
		        					return obj.data;     
		        				},
		        				initrowdetails: initrowdetails,
		                        columns: [
		                            { text: "순번", datafield: "num", width: 5 + "%", minwidth: 50.9},
		                            { text: "그룹", datafield: "branch_cd", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "사용자ID", datafield: "emp_id", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "이름", datafield: "emp_nm", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "발신번호", datafield: "caller", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "수신번호", datafield: "called", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "통화일자", datafield: "call_date", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "통화시각", datafield: "call_hour", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "통화시간", datafield: "call_time", width: 9.090909 + "%", minwidth: 91.7333},
		                            { text: "유형", datafield: "rec_type", width: 9.090909 + "%", minwidth: 91.7333},//"+call[i].dirname+""+call[i].fname+"
		                            { text: "<button class='btn btn-default' id='zipDown_bt'>받기</button>", datafield: "dirname", width: 9.090909 + "%", minwidth: 91.7333}
		                        ]
		            });
	        	
	        }
	        
	});
</script>
	<script type="text/javascript" th:src="@{/resource/assets/js/util/format.js}"></script>
</head>
<body>
    <div class="wrapper gray-bg" id="page-wrapper">
        
        <div class="ibox">
            <div class="ibox-title">
                <div class="title_wrap">
                    <h2>
                        <img src="/logo" alt="company_logo"> <span>검색/청취</span>
                    </h2>
                    <input type="button" id="testid"> 
                </div>
                <!-- Button trigger modal -->
                <button  id="popbt" type="button" class="btn btn-primary btn-lg hide" data-toggle="modal" data-target="#search_filter">
                    <span>검색</span> <i class="fa fa-filter" aria-hidden="true"></i>
                </button>

            </div>
            <div class="ibox-content">
                <div class="list_search first_page">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <div class="col-sm-4">
                                <label class="col-lg-4">그룹</label>
                                <div class="col-lg-8">
                                    <div class="group_btn_act" id="group_btn_act1"> </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="col-lg-4">사용자 ID 또는 이름</label>
                                <div class="col-lg-8">
                                    <div class="input-group">
                                      <input type="text" class="form-control user_name" placeholder="" id="emp1">
                                      <span type="text" placeholder="" class="input-group-btn" th:if="${#authentication.details.auth_cd eq'00'}">
                                        <button class="btn btn-default" type="button" id="id_user_search1">사용자 검색</button>
                                      </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="col-lg-4">업체명</label>
                                <div class="col-lg-8">
                                    <input type="text" class="form-control" placeholder="" id="">
                                </div>
                            </div>
                        </div>
                        <div class="bottom_line"></div>
                        <div class="form-group">
                            <div class="col-sm-4">
                                <label class="col-lg-4">통화날짜</label>
                                <div class="col-lg-8">
                                    <div class="jqxcalendar_act" id="jqxcalendar_act1">
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="col-lg-4">통화시각</label>
                                <div class="col-lg-8">
                                    <div class="col-sm-5">
                                        <select name="selStartTime" class="form-control selStartTime" id="selStartTime1">
                                        </select>
                                    </div>
                                    <div class="col-sm-2">~</div>
                                        
                                    <div class="col-sm-5">
                                        <select name="selEndTime" class="selEndTime form-control" id="selEndTime1"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="col-lg-4">통화시간</label>
                                <div class="col-lg-8">
                                    <div class="dropdown col-sm-5">
                                        <input type="text" class="form-control col-lg-10 time_start" id="start_talk_time1" placeholder="03">
                                    </div>
                                    <div class="col-sm-2">~</div>
                                    <div class="dropdown col-sm-5">
                                        <input type="text" class="form-control col-lg-10 time_end" id="end_talk_time1" placeholder="sec">
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-4">
                                <label class="col-lg-4">수신전화번호</label>
                                <div class="col-lg-8 input-group">
                                    <input type="text" class="form-control receive_number" id="called1" placeholder="">
                                	<div class="input-group-btn">
                                        <button type="button" id="called1_bt" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">선택 <span class="caret"></span></button>
                                        <ul class="dropdown-menu" role="menu" id="called1_ul">
                                          <li><a href="#">포함</a></li>
                                          <li><a href="#">정확</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="col-lg-4">발신전화번호</label>
                                <div class="col-lg-8 input-group">
                                    <input type="text" class="form-control col-lg-8 send_number" id="caller1" placeholder="">
                                	<div class="input-group-btn">
                                        <button type="button" id="caller1_bt"class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">선택 <span class="caret"></span></button>
                                        <ul class="dropdown-menu" role="menu" id="caller1_ul">
                                          <li><a href="#">포함</a></li>
                                          <li><a href="#">정확</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="col-lg-4">녹취유형</label>
                                <div class="col-lg-8">
                                    <div class="record_type" id="record_type1"> </div>
                                </div>
                            </div>
                        </div>
                        <div class="bottom_line"></div>
                        <div class="form-group btn_group">
                            <button type="button" class="btn btn-default next_action" id="next_action1">조회</button>
                        </div>
                    </form>
                </div>
                <div class="list hide">
                    <div class="list_table">
                        <div class="container">
                            <div id="grid">
                            </div>
                            
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>



<!-- 사용자 검색 -->
<div class="modal fade" id="user_search" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">녹취 사용자 선택</h4>
        </div>
        <div class="modal-body">

        <div class="list_search">
            <form class="form-horizontal">
                <div class="form-group">
                    <div class="col-sm-1"></div>
                    <div class="col-sm-3">
                        <label class="col-lg-4">그룹</label>
                        <div class="col-lg-8">
                            <div class="group_btn_act1"> </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-lg-4">권한등급</label>
                        <div class="col-lg-8">
                            <div class="authority_num"></div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-lg-4">사용자</label>
                        <div class="col-lg-8">
                            <input type="text" class="form-control" placeholder="" id="emp3">
                            
                        </div>
                    </div>
                    <div class="col-sm-1">
                        <input type="button" class="btn btn-primary" value="검색" id="id_user_search3">
                    </div>
                    <div class="col-sm-1"></div>
                </div>
            </form>
        </div>
        <div class="bottom_line"></div>
        <div class="user_search_con">
            <div class="user_search_grid">
                
            </div>
        </div>
      </div>
    </div>
  </div>
</div>



</body>

</html>